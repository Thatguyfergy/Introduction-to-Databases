SELECT * FROM MALL

SELECT * FROM USERSHOP

SELECT * FROM SHOP

INSERT INTO SHOP(SID, Type, MID) VALUES
(1, 'Retail', 1),
(2, 'Retail', 1),
(3, 'Supermarket', 1),
(4, 'Convenience Store', 1),
(5, 'Electronics', 1),
(6, 'Retail', 1),
(7, 'Retail', 2),
(8, 'Retail', 2),
(9, 'Supermarket', 2),
(10, 'Convenience Store', 2),
(11, 'Electronics', 2),
(12, 'Retail', 2),
(13, 'Retail', 3),
(14, 'Retail', 3),
(15, 'Supermarket', 3),
(16, 'Convenience Store', 3),
(17, 'Electronics', 3),
(18, 'Retail', 3),
(19, 'Furniture', 4),
(20, 'Retail', 4),
(21, 'Supermarket', 4),
(22, 'Convenience Store', 4),
(23, 'Electronics', 4),
(24, 'Retail', 4),
(25, 'Retail', 5),
(26, 'Supermarket', 5),
(27, 'Convenience Store', 5),
(28, 'Electronics', 5),
(29, 'Furniture', 5),
(30, 'Retail', 5);



INSERT INTO USERSHOP(SID, UID, amountSpent, dateTimeIn, dateTimeOut) VALUES
(1, 1, 100.00, '2023-12-01 10:00:00', '2023-12-01 12:00:00'),
(2, 1, 50.00, '2023-12-02 11:00:00', '2023-12-02 13:00:00'),
(3, 1, 120.00, '2023-12-05 14:00:00', '2023-12-05 16:00:00'),
(4, 1, 80.00, '2023-12-08 09:00:00', '2023-12-08 11:00:00'),
(5, 1, 200.00, '2023-12-10 10:30:00', '2023-12-10 12:30:00'),
(6, 1, 150.00, '2023-12-12 13:00:00', '2023-12-12 15:00:00'),
(12, 1, 70.00, '2023-12-15 11:30:00', '2023-12-15 13:30:00'),
(7, 2, 80.00, '2023-12-01 09:30:00', '2023-12-01 11:30:00'),
(8, 2, 90.00, '2023-12-03 10:00:00', '2023-12-03 12:00:00'),
(9, 2, 120.00, '2023-12-06 12:30:00', '2023-12-06 14:30:00'),
(10, 2, 150.00, '2023-12-08 14:00:00', '2023-12-08 16:00:00'),
(11, 2, 200.00, '2023-12-10 10:00:00', '2023-12-10 12:00:00'),
(12, 2, 100.00, '2023-12-12 11:00:00', '2023-12-12 13:00:00'),
(13, 3, 100.00, '2023-12-02 10:00:00', '2023-12-02 12:00:00'),
(14, 3, 120.00, '2023-12-04 11:30:00', '2023-12-04 13:30:00'),
(15, 3, 90.00, '2023-12-07 14:00:00', '2023-12-07 16:00:00'),
(16, 3, 150.00, '2023-12-09 09:00:00', '2023-12-09 11:00:00'),
(17, 3, 180.00, '2023-12-11 10:30:00', '2023-12-11 12:30:00'),
(18, 3, 200.00, '2023-12-14 13:00:00', '2023-12-14 15:00:00'),
(19, 4, 120.00, '2023-12-01 09:00:00', '2023-12-01 11:00:00'),
(20, 4, 100.00, '2023-12-03 10:30:00', '2023-12-03 12:30:00'),
(21, 4, 80.00, '2023-12-06 12:00:00', '2023-12-06 14:00:00'),
(22, 4, 150.00, '2023-12-08 14:30:00', '2023-12-08 16:30:00'),
(23, 4, 200.00, '2023-12-11 10:00:00', '2023-12-11 12:00:00'),
(24, 4, 90.00, '2023-12-13 11:00:00', '2023-12-13 13:00:00'),
(25, 5, 100.00, '2023-12-02 09:30:00', '2023-12-02 11:30:00'),
(26, 5, 120.00, '2023-12-04 10:00:00', '2023-12-04 12:00:00'),
(27, 5, 90.00, '2023-12-07 11:30:00', '2023-12-07 13:30:00'),
(28, 5, 150.00, '2023-12-09 14:00:00', '2023-12-09 16:00:00'),
(29, 5, 200.00, '2023-12-12 09:00:00', '2023-12-12 11:00:00'),
(30, 5, 100.00, '2023-12-14 10:30:00', '2023-12-14 12:30:00');


WITH Compulsive_Shoppers AS (
    SELECT US.UID, SUM(US.amountSpent) AS TotalSpent
    FROM USERSHOP US
    INNER JOIN SHOP S ON US.SID = S.SID
    INNER JOIN MALL M ON S.MID = M.MID
    WHERE US.dateTimeIn >= '2023-12-01 00:00:00' AND US.dateTimeOut <= '2023-12-31 23:59:59'
    GROUP BY US.UID, S.MID
    HAVING COUNT(*) > 5
),
Youngest_Compulsive_Shoppers AS (
    SELECT UA.UID, UA.Name, UA.DOB, CS.TotalSpent
    FROM USER_ACCOUNT UA
    INNER JOIN Compulsive_Shoppers CS ON UA.UID = CS.UID
)
SELECT *
FROM Youngest_Compulsive_Shoppers
ORDER BY DOB DESC;